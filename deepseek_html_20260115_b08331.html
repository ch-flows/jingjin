<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
  <title>åæ–‡è¡¨è¾¾ç²¾è¿›å¡</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.cn/css2?family=Noto+Serif+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #667eea;
      --primary-dark: #5a67d8;
      --primary-light: #a3bffa;
      --secondary: #ed8936;
      --accent: #48bb78;
      --text-primary: #2d3748;
      --text-secondary: #718096;
      --bg-primary: #ffffff;
      --bg-secondary: #f7fafc;
      --bg-gradient: linear-gradient(135deg, #5A3C80 0%, #4A6FA5 50%, #6A4C93 100%);
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 1px 3px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1), 0 4px 6px rgba(0,0,0,0.05);
      --shadow-xl: 0 20px 25px rgba(0,0,0,0.15), 0 10px 10px rgba(0,0,0,0.04);
      --radius: 24px;
      --radius-sm: 16px;
      --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      --english-color: #4A1D96;
      --dark-blue: #1e3a8a;
      --light-blue: #3b82f6;
      --error-color: #dc2626;
      --correct-color: #059669;
      --dark-green: #047857;
    }
    .copyright-icon {
      color: rgba(255, 255, 255, 0.85);
    }
    .dropdown {
      background: rgba(163, 191, 250, 0.95);
    }
    #card {
      background: 
        linear-gradient(
          90deg, 
          #5A3C80 0%, 
          #4A6FA5 20%, 
          #6A4C93 50%, 
          #7c6eea 80%, 
          #5A3C80 100%
        ) top / 100% 12px no-repeat,
        rgba(255, 255, 255, 0.96) 0% 12px / 100% calc(100% - 12px) no-repeat;
    }
    .card-star {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      color: #4A6FA5;
      pointer-events: none;
      z-index: 10;
      /* ç®€åŒ–æ ·å¼ï¼Œç§»é™¤æ‰€æœ‰æ•ˆæœ */
      background: none;
      border: none;
      box-shadow: none;
      padding: 0;
      border-radius: 0;
    }
    .creator-content {
      background: linear-gradient(135deg, #5A3C80 0%, #4A6FA5 50%, #6A4C93 100%);
    }
    .dropdown-option {
      background: transparent !important;
      color: white !important;
      border: none !important;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      font-family: 'Arial', sans-serif;
      padding: 8px 12px;
      border-radius: 6px;
    }
    .dropdown-option:hover,
    .dropdown-option.active {
      background: linear-gradient(135deg, #5A3C80 0%, #4A6FA5 100%) !important;
      color: white !important;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    html {
      height: 100%;
      width: 100%;
      overflow: auto;
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
      -webkit-overflow-scrolling: touch;
    }
    body {
      min-height: 100%;
      width: 100%;
      font-family: 'Arial', 'Noto Serif SC', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-gradient);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: auto;
      touch-action: manipulation;
      padding: 0;
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
      -webkit-overflow-scrolling: touch;
      position: relative;
    }
    .background-fixed {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(135deg, #5A3C80 0%, #4A6FA5 50%, #6A4C93 100%),
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
      z-index: -2;
      pointer-events: none;
    }
    
    /* æ ¸å¿ƒä¿®å¤ï¼šæ•´ä¸ªåº”ç”¨å®¹å™¨ç¼©æ”¾ */
    .app-container {
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 16px;
      gap: 16px;
      min-height: auto;
      height: auto;
      flex: 0 1 auto;
      margin: auto;
      position: relative;
      background: transparent;
      transform-origin: center top;
      transition: transform 0.3s ease;
    }
    
    .header {
      text-align: center;
      width: 100%;
      padding: 8px 0;
      margin-bottom: 4px;
      transition: var(--transition);
    }
    .header-content {
      padding: 8px;
    }
    .logo {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
      font-family: 'Noto Serif SC', serif;
    }
    .subtitle {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.9);
      font-family: 'Noto Serif SC', serif;
      line-height: 1.4;
    }
    .dataset-selector {
      width: 100%;
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }
    .nav-btn {
      flex: 1;
      height: 46px;
      background: rgba(255, 255, 255, 0.18);
      backdrop-filter: blur(12px);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      font-size: 20px;
      font-weight: 400;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: var(--shadow-md);
      font-family: 'Noto Serif SC', serif;
    }
    .nav-btn.active {
      background: rgba(255, 255, 255, 0.35);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }
    .nav-btn:active {
      transform: translateY(0);
    }
    .card-container {
      width: 100%;
      height: 340px;
      position: relative;
    }
    #card {
      width: 100%;
      height: 100%;
      backdrop-filter: blur(25px);
      border-radius: var(--radius);
      padding: 28px 24px;
      text-align: center;
      box-shadow: var(--shadow-xl);
      position: relative;
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: visible;
      border: 1px solid rgba(255, 255, 255, 0.4);
      cursor: pointer;
    }
    #card:active {
      transform: translateY(-3px);
      box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.2);
    }
    .card-click-left, .card-click-right {
      position: absolute;
      top: 0;
      height: 100%;
      width: 50%;
      z-index: 5;
    }
    .card-click-left {
      left: 0;
    }
    .card-click-right {
      right: 0;
    }
    #card-text {
      font-size: 28px;
      line-height: 1.4;
      word-break: break-word;
      font-weight: 300;
      color: var(--dark-blue);
      white-space: pre-line;
      font-family: 'Noto Serif SC', serif;
      -webkit-user-select: text;
      user-select: text;
      max-width: 100%;
    }
    .card-image {
      max-width: 40%;
      max-height: 110px;
      border-radius: 10px;
      margin-bottom: 4px;
      border: 3px solid #e2e8f0;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      margin-top: 10px;
      position: relative;
      z-index: 2;
    }
    .divider {
      width: 85%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--primary-light), transparent);
      margin: 20px 0;
      border-radius: 2px;
    }
    .vertical-divider {
      width: 2px;
      height: 100px;
      background: linear-gradient(to bottom, transparent, var(--primary-light), transparent);
      margin: 0 8px;
      border-radius: 2px;
      position: relative;
      z-index: 1;
    }
    .correct-character {
      font-size: 80px;
      font-weight: 700;
      color: var(--dark-green);
      text-shadow: 0 4px 12px rgba(0,0,0,0.2);
      font-family: 'Noto Serif SC', serif;
      margin-right: 16px;
      position: relative;
      z-index: 2;
      margin-bottom: 4px;
      transform: translateY(20px);
    }
    .typo-back-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      gap: 4px;
      position: relative;
    }
        /* --- ç”¨äºå•ç‹¬ä¸Šç§»èƒŒé¢PNGå›¾ç‰‡ --- */
    .typo-back-container .card-image {
      transform: translateY(-25px) !important; /* å‘ä¸Šç§»åŠ¨15åƒç´  */
    }

    .typo-image-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
  
      /* --- â–¼â–¼â–¼ æ ¸å¿ƒä¿®æ”¹ â–¼â–¼â–¼ --- */
      justify-content: center; /* ä¿®æ”¹ï¼è®©å†…éƒ¨å…ƒç´ ï¼ˆå›¾ç‰‡å’Œæ ‡ç­¾ï¼‰ä½œä¸ºä¸€ä¸ªæ•´ä½“å‚ç›´å±…ä¸­ */
      /* --- â–²â–²â–² ä¿®æ”¹ç»“æŸ â–²â–²â–² --- */

      height: 100%;
      position: relative;
      min-height: 200px;
  
      /* æ–°å¢ä¸€ä¸ªå†…è¾¹è·ï¼ŒæŠŠå†…å®¹ç¨å¾®å‘ä¸‹æ¨ï¼Œä»¥è¾¾åˆ°æ›´å¥½çš„è§†è§‰å¹³è¡¡ */
      padding-top: 20px; 
    }
    .typo-image-container {
      padding-top: 10px;
    }
    /* ======================================================================= */
/* â–¼â–¼â–¼ ç”¨è¿™ä¸ªæ–°ç‰ˆæœ¬æ›¿æ¢æ—§çš„ .typo-character-container è§„åˆ™ â–¼â–¼â–¼ */
/* ======================================================================= */
    .typo-character-container {
      flex: 1; /* ç¡®ä¿å®ƒèƒ½æ­£ç¡®å æ®ä¸€åŠç©ºé—´ */
      display: flex;
  
      /* --- æ ¸å¿ƒä¿®æ”¹ --- */
      flex-direction: column; /* å…³é”®ï¼è®©å†…éƒ¨å…ƒç´ ï¼ˆæ±‰å­—å’Œæ ‡ç­¾ï¼‰å‚ç›´æ’åˆ— */
      justify-content: center;  /* å…³é”®ï¼è®©è¿™ä¸€æ•´åˆ—å‚ç›´å±…ä¸­ */
      align-items: center;      /* å…³é”®ï¼è®©è¿™ä¸€æ•´åˆ—æ°´å¹³å±…ä¸­ */

      height: 100%; /* ç¡®ä¿å®¹å™¨æœ‰é«˜åº¦ */
      position: relative;
      min-height: 200px;
    }

    .typo-image-container .card-image {
      transform: translateY(6px);
    }
    .typo-connector {
      position: absolute;
      bottom: 55px;
      width: 100%;
      height: 1px;
      background: linear-gradient(
        90deg, 
        transparent 0%, 
        var(--primary-light) 20%, 
        var(--primary) 50%, 
        var(--primary-light) 80%, 
        transparent 100%
      );
      z-index: 1;
    }
    .typo-label {
      font-size: 22px;
      color: var(--dark-blue);
      margin-top: 10px;
      font-weight: 300;
      font-family: 'Noto Serif SC', serif;
      position: relative;
      z-index: 2;
      background: transparent !important;
      padding: 2px 6px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 20px;
      line-height: 1;
      transform: translateY(20px);
    }
    .typo-label-right {
      font-size: 22px;
    }
    .typo-label-right {
      margin-top: 55px;
    }
    .typo-label::before {
      content: "ï¼ˆ";
    }
    .typo-label::after {
      content: "ï¼‰";
    }
    .typo-label-right::before {
      content: "ï¼ˆ";
    }
    .typo-label-right::after {
      content: "ï¼‰";
    }
    .sentence-container {
      width: 100%;
      text-align: center;
    }
    .sentence-part {
      margin-bottom: 16px;
    }
    .sentence-label {
      font-size: 15px;
      color: var(--text-secondary);
      margin-bottom: 6px;
      font-weight: 700;
      font-family: 'Noto Serif SC', serif;
    }
    .original-sentence {
      font-size: 22px;
      line-height: 1.5;
      font-family: 'Noto Serif SC', serif;
      color: var(--dark-blue);
      font-weight: 300;
    }
    .corrected-sentence {
      font-size: 22px;
      line-height: 1.5;
      font-family: 'Noto Serif SC', serif;
      color: var(--correct-color);
      font-weight: 300;
    }
    .translation-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    .translation-main {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin: 16px 0;
      width: 100%;
    }
    .chinese-text {
      color: var(--primary-dark);
      font-family: 'Noto Serif SC', serif;
      font-weight: 700;
      font-size: 24px;
    }
    .english-text {
      color: var(--dark-blue);
      font-family: Arial, sans-serif;
      font-size: 28px;
      font-weight: 300;
    }
    .english-text-back {
      color: var(--dark-blue);
      font-family: Arial, sans-serif;
      font-size: 28px;
      font-weight: 300;
    }
    .example-container {
      width: 100%;
      text-align: center;
    }
    .example-text {
      font-size: 22px;
      color: var(--dark-blue);
      line-height: 1.5;
      margin-top: 12px;
      font-style: normal;
      font-family: 'Noto Serif SC', serif;
      font-weight: 300;
      padding: 0;
    }
    .sentence-hint {
      font-size: 22px;
      color: var(--dark-blue);
      line-height: 1.4;
      margin-top: 12px;
      font-style: normal;
      font-family: 'Noto Serif SC', serif;
      font-weight: 300;
      padding: 0;
    }
    .example-line {
      display: block;
      margin-bottom: 6px;
    }
    .progress-container {
      width: 100%;
      /* max-width: 400px; */ /* <-- æ³¨é‡Šæ‰æˆ–åˆ é™¤è¿™ä¸€è¡Œ */
      margin: 4px 0;
      position: relative;
      /* contain: content; */ /* å¦‚æœæœ‰è¿™è¡Œå°±ä¿ç•™å®ƒ */
    }
    #progress {
      text-align: center;
      font-size: 15px;
      color: rgba(255, 255, 255, 0.95);
      font-weight: 300;
      margin-bottom: 8px;
      font-family: 'Noto Serif SC', serif;
    }
    .progress-bar {
      position: relative;
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.25);
      border-radius: 3px;
      overflow: visible;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .progress-bar:active {
      transform: scaleY(1.3);
    }
    .progress-bar:active .progress-fill {
      background: linear-gradient(90deg, var(--accent) 0%, #fff 100%);
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-light) 0%, white 100%);
      border-radius: 3px;
      transition: width 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
      position: relative;
      overflow: hidden;
    }
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.7), transparent);
      animation: shimmer 2.5s infinite;
    }
    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    .progress-slider-container {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 24px;
      transform: translateY(-50%);
      cursor: pointer;
      z-index: 5;
      touch-action: none;
    }
    .progress-slider {
      position: absolute;
      top: 50%;
      left: 0;
      width: 24px;
      height: 6px;
      background: white;
      border: 2px solid var(--primary);
      border-radius: 3px;
      transform: translate(-50%, -50%);
      box-shadow: 
        0 2px 6px rgba(0,0,0,0.3),
        0 0 0 0px rgba(106, 76, 147, 0);
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      touch-action: none;
      overflow: hidden;
    }
    .progress-slider::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(106, 76, 147, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.3s, height 0.3s;
    }
    .progress-slider:active::before {
      width: 40px;
      height: 40px;
    }
    .progress-slider.active {
      transform: translate(-50%, -50%) scale(1.3);
      border-color: var(--accent);
      box-shadow: 
        0 4px 12px rgba(0,0,0,0.4),
        0 0 0 8px rgba(106, 76, 147, 0.2);
    }
    .progress-slider.dragging {
      transform: translate(-50%, -50%) scale(1.4);
      border-color: var(--accent);
      box-shadow: 
        0 6px 16px rgba(0,0,0,0.5),
        0 0 0 12px rgba(74, 111, 165, 0.15);
    }
    .controls {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      margin-top: 8px;
      z-index: 10;
    }
    .btn-row {
      display: flex;
      gap: 8px;
      width: 100%;
      justify-content: center;
    }
    .btn {
      height: 52px;
      min-width: 52px;
      flex: 1;
      font-size: 14px;
      font-weight: 700;
      border: none;
      border-radius: var(--radius-sm);
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(15px);
      color: white;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 
        0 2px 10px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .btn:active {
      transform: translateY(-2px);
      box-shadow: 
        0 4px 15px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    }
    .btn-icon {
      font-size: 20px;
      transition: var(--transition);
      color: rgba(255, 255, 255, 0.85);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      background: none !important;
      font-family: system-ui, -apple-system, sans-serif;
    }
    .btn-primary .btn-icon {
      font-size: 22px;
    }
    .reset-icon-svg {
      width: 24px;
      height: 24px;
      fill: none;
      stroke: rgba(255, 255, 255, 0.85);
      stroke-width: 1.5;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .auto-play-icon {
      font-size: 14px;
      letter-spacing: -2px;
    }
    .btn-primary {
      background: rgba(255, 255, 255, 0.12);
    }
    .btn:hover .btn-icon {
      transform: scale(1.1);
    }
    .btn:active .btn-icon {
      transform: scale(0.95);
    }
    .copyright-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 16px;
      z-index: 5;
      cursor: pointer;
      transition: var(--transition);
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      box-shadow: none;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      width: auto;
      height: auto;
      border-radius: 0;
    }
    .copyright-icon:hover {
      color: rgba(255, 255, 255, 0.9);
      transform: translate(-50%, -50%) scale(1.1);
    }
    .copyright-icon:active {
      transform: translate(-50%, -50%) scale(0.95);
    }
    .creator-info {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      backdrop-filter: blur(10px);
    }
    .creator-info.active {
      opacity: 1;
      visibility: visible;
    }
    .creator-content {
      padding: 30px;
      border-radius: var(--radius);
      text-align: center;
      box-shadow: var(--shadow-xl);
      max-width: 80%;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.5s ease;
    }
    .creator-info.active .creator-content {
      transform: translateY(0);
    }
    .creator-title {
      font-size: 24px;
      color: white;
      margin-bottom: 20px;
      font-family: 'Noto Serif SC', serif;
    }
    .creator-name {
      font-size: 32px;
      color: white;
      font-weight: bold;
      margin-bottom: 10px;
      font-family: 'Noto Serif SC', serif;
    }
    .creator-quote {
      font-size: 18px;
      color: rgba(255, 255, 255, 0.9);
      font-style: normal;
      margin-top: 20px;
      padding: 15px;
      border-left: 3px solid rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-family: 'Noto Serif SC', serif;
      line-height: 1.6;
    }
    .creator-quote-english {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.8);
      font-style: normal;
      margin-top: 8px;
      font-family: 'Arial', sans-serif;
      font-weight: 300;
    }
    .close-creator {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      transition: var(--transition);
    }
    .close-creator:hover {
      transform: scale(1.2);
    }
    .zoom-controls {
      position: fixed;
      bottom: 15px;
      right: 15px;
      display: flex;
      flex-direction: row;
      gap: 2px;
      z-index: 1000;
    }
    .zoom-btn {
      width: 32px;
      height: 32px;
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      font-weight: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .zoom-indicator {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 6px 10px;
      border-radius: 16px;
      font-size: 12px;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }
    .btn-auto {
      background: rgba(255, 255, 255, 0.08);
    }
    .btn-auto.active {
      background: rgba(255, 255, 255, 0.35);
      border-color: rgba(255, 255, 255, 0.5);
    }
    .pause-icon {
      font-size: 18px;
      font-weight: 300;
    }
    .dropdown {
      position: fixed;
      backdrop-filter: blur(20px);
      border-radius: var(--radius-sm);
      padding: 8px;
      box-shadow: var(--shadow-xl);
      z-index: 1000;
      border: 1px solid rgba(255, 255, 255, 0.4);
      display: none;
      min-width: 60px;
      width: 60px;
    }
    .dropdown-options {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    @media (max-width: 480px) {
      .app-container {
        gap: 14px;
      }
      .card-container {
        height: 300px;
      }
      #card {
        padding: 24px 20px;
      }
      #card-text {
        font-size: 24px;
      }
      .btn-row {
        gap: 6px;
      }
      .btn {
        height: 48px;
        min-width: 48px;
      }
      .btn-icon {
        font-size: 18px;
        background: none !important;
      }
      .btn-primary .btn-icon {
        font-size: 20px;
      }
      .reset-icon-svg {
        width: 20px;
        height: 20px;
      }
      .dataset-selector {
        flex-wrap: wrap;
        gap: 6px;
      }
      .nav-btn {
        min-width: 100px;
        height: 42px;
        font-size: 18px;
        font-weight: 400;
      }
      .correct-character {
        font-size: 70px;
      }
      .translation-main {
        font-size: 22px;
      }
      .chinese-text {
        font-size: 22px;
      }
      .english-text, .english-text-back {
        font-size: 24px;
      }
      .typo-back-container {
        gap: 3px;
      }
      .vertical-divider {
        margin: 0 6px;
      }
      .card-image {
        max-width: 40%;
        max-height: 110px;
      }
      .typo-image-container .card-image {
        transform: translateY(5px);
      }
      .original-sentence, .corrected-sentence {
        font-size: 20px;
      }
      .logo {
        font-size: 28px;
      }
      .copyright-icon {
        font-size: 14px;
      }
      .zoom-controls {
        bottom: 10px;
        right: 10px;
      }
      .zoom-btn {
        width: 28px;
        height: 28px;
        font-size: 18px;
        font-weight: 100;
      }
      .zoom-indicator {
        top: 10px;
        right: 10px;
        font-size: 11px;
        padding: 5px 8px;
      }
      .example-text {
        font-size: 20px;
      }
      .sentence-hint {
        font-size: 20px;
      }
      #shuffleBtn .btn-icon {
        font-weight: 300;
        text-shadow: none;
      }
      #progress {
        font-weight: 300;
      }
      .dropdown {
        min-width: 55px;
        width: 55px;
      }
      .auto-play-icon {
        font-size: 12px;
      }
    }
    @media (max-width: 380px) {
      .app-container {
        gap: 12px;
      }
      .card-container {
        height: 280px;
      }
      .btn {
        height: 44px;
        min-width: 44px;
      }
      .btn-icon {
        font-size: 16px;
      }
      .btn-primary .btn-icon {
        font-size: 18px;
      }
      .reset-icon-svg {
        width: 18px;
        height: 18px;
      }
      .logo {
        font-size: 24px;
      }
      .nav-btn {
        font-size: 16px;
        font-weight: 400;
      }
      .typo-image-container .card-image {
        transform: translateY(4px);
      }
      .example-text {
        font-size: 18px;
      }
      .sentence-hint {
        font-size: 18px;
      }
      #shuffleBtn .btn-icon {
        font-weight: 300;
        text-shadow: none;
      }
      .zoom-btn {
        font-weight: 100;
      }
      #progress {
        font-weight: 300;
      }
      .dropdown {
        min-width: 50px;
        width = 50px;
      }
      .auto-play-icon {
        font-size: 11px;
      }
    }
    @media (min-width: 1025px) {
      .app-container {
        max-width: 700px;
        padding: 30px 40px;
        gap: 20px;
      }
      .header {
        padding: 12px 0;
        margin-bottom: 8px;
      }
      .logo {
        font-size: 42px;
        margin-bottom: 8px;
      }
      .subtitle {
        font-size: 18px;
      }
      .card-container {
        height: 320px;
        margin: 15px 0;
      }
      #card {
        padding: 40px 35px;
        border-radius: 28px;
      }
      #card-text {
        font-size: 32px;
        padding: 0 16px;
      }
      .progress-container {
        margin: 12px 0;
      }
      #progress {
        font-size: 18px;
        margin-bottom: 8px;
        font-weight: 300;
      }
      .progress-bar {
        height: 8px;
      }
      .progress-slider {
        height: 8px;
        width: 32px;
      }
      .controls {
        gap: 15px;
        padding: 12px 0;
        margin-top: 15px;
      }
      .btn-row {
        gap: 16px;
      }
      .btn {
        height: 68px;
        min-width: 90px;
        padding: 0 16px;
        border-radius: 22px;
      }
      .btn-icon {
        font-size: 24px;
      }
      .btn-primary .btn-icon {
        font-size: 24px;
      }
      .reset-icon-svg {
        width: 26px;
        height: 26px;
      }
      .zoom-controls {
        bottom: 20px;
        right: 20px;
      }
      .zoom-btn {
        width: 40px;
        height: 40px;
        font-size: 24px;
        font-weight: 100;
      }
      .zoom-indicator {
        top: 20px;
        right: 20px;
        font-size: 16px;
        padding: 8px 12px;
      }
      .example-text {
        font-size: 24px;
      }
      .sentence-hint {
        font-size: 24px;
      }
      #shuffleBtn .btn-icon {
        font-weight: 300;
        text-shadow: none;
      }
      .nav-btn {
        font-weight: 400;
      }
      .auto-play-icon {
        font-size: 16px;
      }
    }
    /* === æ‰‹æœºç«¯æ ·å¼ä¿®æ­£ï¼ˆå¼€å§‹ï¼‰ === */

@media (max-width: 480px) {
  /* æ ¸å¿ƒä¿®æ­£ï¼šè°ƒæ•´é”™åˆ«å­—å¡ç‰‡èƒŒé¢çš„å…ƒç´ å¸ƒå±€ */
  .typo-image-container .card-image {
    max-width: 65% !important;
    max-height: 150px !important;
    transform: translateY(-15px) !important;
  }
  
  .typo-image-container .typo-label {
    transform: translateY(32px) !important;
    margin-top: 18px !important;
  }
  
  .typo-character-container .typo-label-right {
    transform: translateY(15px) !important;
    margin-top: 45px !important;
  }
  
  .correct-character {
    font-size: 85px !important;
    transform: translateY(15px) !important;
  }

  /* å…¶ä»–æ‰‹æœºç«¯é€šç”¨å¸ƒå±€å¾®è°ƒ */
  .app-container {
    gap: 14px;
  }
  .card-container {
    height: 300px;
  }
  #card {
    padding: 24px 20px;
  }
  #card-text {
    font-size: 24px;
  }
  .btn-row {
    gap: 6px;
  }
  .btn {
    height: 48px;
    min-width: 48px;
  }
  .btn-icon {
    font-size: 18px;
  }
  .btn-primary .btn-icon {
    font-size: 20px;
  }
  .reset-icon-svg {
        width: 20px;
        height: 20px;
      }
      .dataset-selector {
        flex-wrap: wrap;
        gap: 6px;
      }
      .nav-btn {
        min-width: 100px;
        height: 42px;
        font-size: 18px;
      }
      .original-sentence, .corrected-sentence {
        font-size: 20px;
      }
      .logo {
        font-size: 28px;
      }
      .example-text, .sentence-hint {
        font-size: 20px;
      }
    }

    @media (max-width: 380px) {
      /* æ ¸å¿ƒä¿®æ­£ï¼šè¶…å°å±å¹•çš„è¿›ä¸€æ­¥å¾®è°ƒ */
      .typo-image-container .card-image {
        max-width: 70% !important;
        max-height: 140px !important;
        transform: translateY(-12px) !important;
      }
      
      .typo-image-container .typo-label {
        transform: translateY(28px) !important;
        margin-top: 15px !important;
      }
      
      .typo-character-container .typo-label-right {
        transform: translateY(12px) !important;
        margin-top: 42px !important;
      }
      
      .correct-character {
        font-size: 80px !important;
        transform: translateY(12px) !important;
      }

      /* å…¶ä»–è¶…å°å±å¹•é€šç”¨å¸ƒå±€å¾®è°ƒ */
      .app-container {
        gap: 12px;
      }
      .card-container {
        height: 280px;
      }
      .btn {
        height: 44px;
        min-width: 44px;
      }
      .btn-icon {
        font-size: 16px;
      }
      .btn-primary .btn-icon {
        font-size: 18px;
      }
      .reset-icon-svg {
        width: 18px;
        height: 18px;
      }
      .logo {
        font-size: 24px;
      }
      .nav-btn {
        font-size: 16px;
      }
      .example-text, .sentence-hint {
        font-size: 18px;
      }
    }

    /* === æ‰‹æœºç«¯æ ·å¼ä¿®æ­£ï¼ˆç»“æŸï¼‰ === */

  </style>
</head>
<body>
  <div class="background-fixed"></div>
  <div class="zoom-indicator" id="zoomIndicator">100%</div>
  <div class="zoom-controls">
    <button class="zoom-btn" id="zoomOutBtn">-</button>
    <button class="zoom-btn" id="zoomInBtn">+</button>
  </div>
  <div class="creator-info" id="creatorInfo">
    <div class="creator-content">
      <button class="close-creator" id="closeCreator">Ã—</button>
      <div class="creator-title">è®¾è®¡åˆ¶ä½œ</div>
      <div class="creator-name">åˆ˜è€å¸ˆ Â©</div>
      <div class="creator-quote">
        é”™è¯¯ï¼Œæ˜¯ç²¾è¿›è¡¨è¾¾çš„å¼€å§‹ã€‚
        <div class="creator-quote-english">Mistakes are the starting point for refining expression.</div>
      </div>
    </div>
  </div>
  
  <!-- æ ¸å¿ƒä¿®å¤ï¼šæ•´ä¸ªåº”ç”¨å®¹å™¨ä¸€èµ·ç¼©æ”¾ -->
  <div class="app-container" id="appContainer">
    <div class="header">
      <div class="header-content">
        <div class="subtitle">ç²¾è¿›è¡¨è¾¾ï¼Œä»è¿™é‡Œå¼€å§‹</div>
        <div class="logo">åæ–‡è¡¨è¾¾ç²¾è¿›å¡</div>
      </div>
    </div>
    <div class="dataset-selector">
      <button class="nav-btn active" data-set="collocations">
        <span>å¸¸ç”¨æ­é…</span>
      </button>
      <button class="nav-btn" data-set="typos">
        <span>é”™åˆ«å­—</span>
      </button>
      <button class="nav-btn" data-set="sentences">
        <span>ç—…å¥</span>
      </button>
    </div>
    
    <div class="card-container">
      <div id="card">
        <div class="card-click-left" id="cardLeft"></div>
        <div class="card-click-right" id="cardRight"></div>
        <div id="card-text">ç‚¹å‡»å¡ç‰‡å¼€å§‹å­¦ä¹ </div>
      </div>
    </div>
    
    <div class="progress-container">
      <div id="progress">0 / 0</div>
      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-slider-container" id="progressSliderContainer">
          <div class="progress-slider" id="progressSlider"></div>
        </div>
      </div>
    </div>
    
    <div class="controls">
      <div class="copyright-icon" id="copyrightBtn">Â©</div>
      <div class="btn-row">
        <button class="btn" id="resetBtn" title="å›åˆ°ç¬¬ä¸€å¼ ">
          <svg class="reset-icon-svg" viewBox="0 0 24 24">
            <line x1="4" y1="7" x2="4" y2="17" />
            <polygon points="12,7 12,17 7,12" fill="none" />
            <polygon points="19,7 19,17 14,12" fill="none" />
          </svg>
        </button>
        <button class="btn" id="shuffleBtn" title="éšæœºæ’åº">
          <span class="btn-icon">â‡„</span>
        </button>
        <button class="btn" id="starBtn" title="æ”¶è—">
          <span class="btn-icon">â˜…</span>
        </button>
        <button class="btn" id="bookmarksBtn" title="æŸ¥çœ‹æ”¶è—">
          <span class="btn-icon">ğŸ”–</span>
        </button>
      </div>
      <div class="btn-row">
        <button class="btn btn-auto" id="autoPlayFrontBtn" title="è‡ªåŠ¨æ’­æ”¾æ­£é¢">
          <span class="btn-icon auto-play-icon">â–·</span>
        </button>
        <button class="btn btn-auto" id="autoPlayBothBtn" title="è‡ªåŠ¨æ’­æ”¾æ­£åé¢">
          <span class="btn-icon auto-play-icon">â–·â–·</span>
        </button>
        <button class="btn btn-primary" id="prevBtn" title="ä¸Šä¸€å¼ ">
          <span class="btn-icon">â†</span>
        </button>
        <button class="btn btn-primary" id="nextBtn" title="ä¸‹ä¸€å¼ ">
          <span class="btn-icon">â†’</span>
        </button>
      </div>
    </div>
  </div>
  
  <div class="dropdown" id="speedDropdown">
    <div class="dropdown-options">
      <button class="dropdown-option" data-speed="1000">1<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-speed="2000">2<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-speed="3000">3<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-speed="4000">4<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-speed="5000">5<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
    </div>
  </div>
  <div class="dropdown" id="translationDropdown">
    <div class="dropdown-options">
      <button class="dropdown-option" data-front-speed="1000">1<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-front-speed="2000">2<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-front-speed="3000">3<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-front-speed="4000">4<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
      <button class="dropdown-option" data-front-speed="5000">5<span style="font-size: 10px; opacity: 0.8;">ã€</span></button>
    </div>
  </div>
  <script>
    // === æ•°æ®éƒ¨åˆ†ï¼ˆå®Œå…¨ä¿ç•™æ‚¨åŸå§‹æ•°æ®ï¼‰===
    const collocationsData = [
      ["conduct activities", "å¼€å±•æ´»åŠ¨ | conduct activities\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nå­¦ç”Ÿä¼šè®¡åˆ’ä¸‹å‘¨åœ¨é‚»é‡Œå…¬å›­ï¼Œ\nå¼€å±•ä¸€æ¬¡æ¸…æ´æ´»åŠ¨ã€‚"],
      ["hold a lecture", "ä¸¾åŠè®²åº§ | hold a lecture\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ°‘ä¼—ä¿±ä¹éƒ¨ä¸ºå±…æ°‘ä¸¾åŠäº†\nä¸€ä¸ªå…³äºç½‘ç»œå®‰å…¨çš„è®²åº§ã€‚"],
      ["design a poster", "è®¾è®¡æµ·æŠ¥ | design a poster\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘ä»¬çš„åæ–‡åŠŸè¯¾æ˜¯è®¾è®¡æµ·æŠ¥ï¼Œ\nä»‹ç»æ–°åŠ å¡çš„ç¾é£Ÿã€‚"],
      ["distribute flyers", "åˆ†å‘ä¼ å• | distribute flyers\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘ä»¬å°†åœ¨åœ°é“ç«™å¤–åˆ†å‘ä¼ å•ï¼Œ\né‚€è¯·å¤§å®¶æ¥å‚åŠ å­¦æ ¡çš„ä¹‰å–ä¼šã€‚"],
      ["take measures", "é‡‡å–æªæ–½ | take measures\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nä¸ºäº†é¢„é˜²éª¨ç—›çƒ­ç—‡ï¼Œå¸‚é•‡ç†äº‹ä¼š\né‡‡å–æªæ–½ï¼Œå®šæœŸæ¸…ç†ç§¯æ°´ã€‚"],
      ["achieve goals", "å®ç°ç›®æ ‡ | achieve goals\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\né€šè¿‡åŠªåŠ›å­¦ä¹ ï¼Œæˆ‘ç»ˆäºå®ç°äº†ç›®æ ‡ï¼Œ\nåœ¨è€ƒè¯•ä¸­å–å¾—äº†å¥½æˆç»©ã€‚"],
      ["learn from mistakes", "å¸å–æ•™è®­ | learn from mistakes\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘è¿™æ¬¡æµ‹éªŒå› ä¸ºæ²¡å¤ä¹ è€Œè€ƒå¾—ä¸å¥½ï¼Œ\næˆ‘å¿…é¡»å¸å–æ•™è®­ï¼Œä¸‹æ¬¡è¦æå‰å‡†å¤‡ã€‚"],
      ["summarize experience", "æ€»ç»“ç»éªŒ | summarize experience\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\néœ²è¥æ´»åŠ¨ç»“æŸåï¼Œæˆ‘ä»¬å›´ååœ¨\nä¸€èµ·æ€»ç»“ç»éªŒï¼Œåˆ†äº«å„è‡ªçš„æ”¶è·ã€‚"],
      ["complete a task", "å®Œæˆä»»åŠ¡ | complete a task\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘ç»™è‡ªå·±è®¾å®šç›®æ ‡ï¼Œæ¯å¤©éƒ½è¦\nå®Œæˆåæ–‡é˜…è¯»çš„ä»»åŠ¡ã€‚"],
      ["solve problems", "è§£å†³é—®é¢˜ | solve problems\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nå±…æ°‘å¯ä»¥é€šè¿‡å¸‚é•‡ç†äº‹ä¼šï¼Œ\nè§£å†³ä¸€äº›å¸¸è§çš„ç¤¾åŒºé—®é¢˜ã€‚"],
      ["overcome difficulties", "å…‹æœå›°éš¾ | overcome difficulties\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nå­¦ä¹ æ¸¸æ³³æ—¶æˆ‘å¾ˆæ€•æ°´ï¼Œä½†åœ¨æ•™ç»ƒçš„\nè€å¿ƒæŒ‡å¯¼ä¸‹ï¼Œæˆ‘æ…¢æ…¢å…‹æœäº†è¿™ä¸ªå›°éš¾ã€‚"],
      ["realize dreams", "å®ç°æ¢¦æƒ³ | realize dreams\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘ç›¸ä¿¡åªè¦åšæŒåŠªåŠ›ï¼Œ\næ¯ä¸ªäººéƒ½æœ‰å¯èƒ½å®ç°è‡ªå·±çš„æ¢¦æƒ³ã€‚"],
      ["develop habits", "å…»æˆä¹ æƒ¯ | develop habits\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ¯å¤©æ™¨è¯»ååˆ†é’Ÿï¼Œ\nèƒ½å¸®åŠ©ä½ å…»æˆé˜…è¯»ä¹ æƒ¯ã€‚"],
      ["cultivate talent", "åŸ¹å…»äººæ‰ | cultivate talent\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ–°åŠ å¡é€šè¿‡ä¼˜è´¨çš„æ•™è‚²ä½“ç³»\næ¥åŸ¹å…»äººæ‰ï¼Œæ¨åŠ¨å›½å®¶è¿›æ­¥ã€‚"],
      ["adopt suggestions", "é‡‡çº³å»ºè®® | adopt suggestions\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nè¿™æ¬¡æˆ‘é‡‡çº³äº†çˆ¶æ¯çš„å»ºè®®ï¼Œ\næå‰å‡†å¤‡è€ƒè¯•ï¼Œæ„Ÿè§‰å‹åŠ›å°äº†å¾ˆå¤šã€‚"],
      ["improve relationships", "æ”¹å–„å…³ç³» | improve relationships\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nè€å¸ˆç»å¸¸å’Œæˆ‘ä»¬èŠå¤©ï¼Œ\nè¿™æœ‰åŠ©äºæ”¹å–„å¸ˆç”Ÿå…³ç³»ã€‚"],
      ["seize opportunities", "æŠŠæ¡æœºä¼š | seize opportunities\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘ä»¬åº”è¯¥æŠŠæ¡ä¸­å­¦æ—¶æœŸçš„\næ¯ä¸€ä¸ªå­¦ä¹ æœºä¼šï¼Œä¸ºæœªæ¥åšå¥½å‡†å¤‡ã€‚"],
      ["strong interest", "æµ“åšçš„å…´è¶£ | strong interest\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nçœ‹åè¯­ç”µè§†å‰§è®©æˆ‘å¯¹åæ–‡\näº§ç”Ÿäº†æ›´æµ“åšçš„å…´è¶£ã€‚"],
      ["deep feelings", "æ·±åšçš„æ„Ÿæƒ… | deep feelings\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘å’Œæˆ‘çš„å©†å©†æœ‰ç€æ·±åšçš„æ„Ÿæƒ…ï¼Œ\nå¥¹å¸¸å¸¸ç»™æˆ‘è®²å¥¹å¹´è½»æ—¶çš„æ•…äº‹ã€‚"],
      ["precious friendship", "çè´µçš„å‹è°Š | precious friendship\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nå››å¹´çš„ä¸­å­¦ç”Ÿæ´»è®©æˆ‘å’ŒåŒå­¦ä»¬\nå»ºç«‹äº†çè´µçš„å‹è°Šã€‚"],
      ["harmonious relationship", "èæ´½çš„å…³ç³» | harmonious relationship\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næˆ‘ä»¬è¿™æ ‹ç»„å±‹çš„å±…æ°‘å…³ç³»å¾ˆèæ´½ï¼Œ\nç»å¸¸åœ¨æ¥¼ä¸‹ä¸€èµ·èŠå¤©ã€‚"],
      ["solid foundation", "æ‰å®çš„åŸºç¡€ | solid foundation\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nå­¦ä¹ é’¢ç´éœ€è¦æœ‰æ‰å®çš„åŸºç¡€ï¼Œ\næ‰€ä»¥è¦æ¯å¤©ç»ƒä¹ æŒ‡æ³•ã€‚"],
      ["thorough preparation", "å……åˆ†çš„å‡†å¤‡ | thorough preparation\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nç”±äºèµ›å‰åšäº†å……åˆ†çš„å‡†å¤‡ï¼Œ\næˆ‘ä»¬çš„ç¯®çƒé˜Ÿèµ¢å¾—äº†æ¯”èµ›ã€‚"],
      ["valuable experience", "å®è´µçš„ç»éªŒ | valuable experience\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nå‡æœŸåœ¨é¤å…æ‰“å·¥è®©æˆ‘\nç§¯ç´¯äº†å®è´µçš„å·¥ä½œç»éªŒã€‚"]
    ];
    const typosData = [
      ["", "æˆ–", "https://i.ibb.co/6JZXrCbk/image.png"],
      ["", "è½", "https://i.ibb.co/fdyyDFny/image.png"],
      ["", "è·", "https://i.ibb.co/TBBMCCbQ/image.png"],
      ["", "è¯•", "https://i.ibb.co/JWw1HykT/shi1.png"],
      ["", "è…»", "https://i.ibb.co/HLqTxN94/ni1.png"],
      ["è¯·åœ¨è¯´ä¸€éã€‚", "åŸå¥ï¼šè¯·åœ¨è¯´ä¸€éã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šè¯·å†è¯´ä¸€é"],
      ["ä»–è·‘çš„å¾ˆå¿«ã€‚", "åŸå¥ï¼šä»–è·‘çš„å¾ˆå¿«ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šä»–è·‘å¾—å¾ˆå¿«"],
      ["è¿™æ˜¯è°åœ°æ‰‹æœºã€‚", "åŸå¥ï¼šè¿™æ˜¯è°åœ°æ‰‹æœºã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šè¿™æ˜¯è°çš„æ‰‹æœº"],
      ["å¤§å®¶åœ¨å¼€å¿ƒå¾—èŠå¤©ã€‚", "åŸå¥ï¼šå¤§å®¶åœ¨å¼€å¿ƒå¾—èŠå¤©ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šå¤§å®¶åœ¨å¼€å¿ƒåœ°èŠå¤©"],
      ["æˆ‘å‘¨æœ«å¾—åŸ¹ä¼´å®¶äººã€‚", "åŸå¥ï¼šæˆ‘å‘¨æœ«å¾—åŸ¹ä¼´å®¶äººã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šæˆ‘å‘¨æœ«å¾—é™ªä¼´å®¶äºº"],
      ["é™ªå…»ä¼˜ç§€çš„äººæ‰ã€‚", "åŸå¥ï¼šé™ªå…»ä¼˜ç§€çš„äººæ‰ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šåŸ¹å…»ä¼˜ç§€çš„äººæ‰"],
      ["å¯¼è‡³ä¸¥é‡çš„åæœã€‚", "åŸå¥ï¼šå¯¼è‡³ä¸¥é‡çš„åæœã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šå¯¼è‡´ä¸¥é‡çš„åæœ"],
      ["åŒè¿‡ä¸æ‡ˆçš„åŠªåŠ›ã€‚", "åŸå¥ï¼šåŒè¿‡ä¸æ‡ˆçš„åŠªåŠ›ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šé€šè¿‡ä¸æ‡ˆçš„åŠªåŠ›"],
      ["ä½ éœ€è¦é©¬ä¸Šåšè§‰å®šã€‚", "åŸå¥ï¼šä½ éœ€è¦é©¬ä¸Šåšè§‰å®šã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šä½ éœ€è¦é©¬ä¸Šåšå†³å®š"],
      ["æˆ‘å› è¯¥æå‰åšäº›å‡†å¤‡ã€‚", "åŸå¥ï¼šæˆ‘å› è¯¥æå‰åšäº›å‡†å¤‡ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šæˆ‘åº”è¯¥æå‰åšäº›å‡†å¤‡"],
      ["æ”¿åºœå°†é‡‡å–æœ‰æ•ˆé”™æ–½ã€‚", "åŸå¥ï¼šæ”¿åºœå°†é‡‡å–æœ‰æ•ˆé”™æ–½ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šæ”¿åºœå°†é‡‡å–æªæ–½"],
      ["è¯·æå‡ºä½ çš„å»ºæ„ã€‚", "åŸå¥ï¼šè¯·æå‡ºä½ çš„å»ºæ„ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šè¯·æå‡ºä½ çš„å»ºè®®"],
      ["è¿™é‡Œå¾ˆçƒ­ï¼Œç”±å…¶æ˜¯ä¸­åˆã€‚", "åŸå¥ï¼šè¿™é‡Œå¾ˆçƒ­ï¼Œç”±å…¶æ˜¯ä¸­åˆã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šè¿™é‡Œå¾ˆçƒ­ï¼Œå°¤å…¶æ˜¯ä¸­åˆ"]
    ];
    const sentencesData = [
      ["æˆ‘ä¸å¤Ÿé’±ã€‚", "åŸå¥ï¼šæˆ‘ä¸å¤Ÿé’±ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šæˆ‘çš„é’±ä¸å¤Ÿã€‚"],
      ["æˆ‘æœ‰å»è¿‡é‚£ä¸ªåœ°æ–¹ã€‚", "åŸå¥ï¼šæˆ‘æœ‰å»è¿‡é‚£ä¸ªåœ°æ–¹ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šæˆ‘å»è¿‡é‚£ä¸ªåœ°æ–¹ã€‚"],
      ["è¿™ä¸ªæ•…äº‹è®©æˆ‘è§‰å¾—å¾ˆæ„ŸåŠ¨ã€‚", "åŸå¥ï¼šè¿™ä¸ªæ•…äº‹è®©æˆ‘è§‰å¾—å¾ˆæ„ŸåŠ¨ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šè¿™ä¸ªæ•…äº‹ä½¿æˆ‘å¾ˆæ„ŸåŠ¨ã€‚"],
      ["æˆ‘ä¸çŸ¥é“å¦‚æœä»–æ˜å¤©ä¼šæ¥ã€‚", "åŸå¥ï¼šæˆ‘ä¸çŸ¥é“å¦‚æœä»–æ˜å¤©ä¼šæ¥ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šæˆ‘ä¸çŸ¥é“ä»–æ˜å¤©æ˜¯å¦ä¼šæ¥ã€‚"],
      ["æˆ‘ä»¬æ­£åœ¨è®¨è®ºå¦‚æœåº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚", "åŸå¥ï¼šæˆ‘ä»¬æ­£åœ¨è®¨è®ºå¦‚æœåº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\næ”¹æ­£ï¼šæˆ‘ä»¬æ­£åœ¨è®¨è®ºæ˜¯å¦åº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚"]
    ];
    const datasets = {
      collocations: collocationsData,
      typos: typosData,
      sentences: sentencesData
    };

    // === æ–°å¢ï¼šæœ¬åœ°å­˜å‚¨ç®¡ç† ===
    const StorageManager = {
      KEY: 'chinese-expression-starred',
      
      saveStarred(starredSet) {
        try {
          const starredArray = Array.from(starredSet);
          localStorage.setItem(this.KEY, JSON.stringify(starredArray));
        } catch (error) {
          console.warn('æ— æ³•ä¿å­˜æ”¶è—æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨:', error);
        }
      },
      
      loadStarred() {
        try {
          const saved = localStorage.getItem(this.KEY);
          if (saved) {
            const starredArray = JSON.parse(saved);
            return new Set(starredArray);
          }
        } catch (error) {
          console.warn('æ— æ³•ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ”¶è—æ•°æ®:', error);
        }
        return new Set();
      },
      
      clearStarred() {
        try {
          localStorage.removeItem(this.KEY);
        } catch (error) {
          console.warn('æ— æ³•æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„æ”¶è—æ•°æ®:', error);
        }
      }
    };

    class AppState {
      constructor() {
        this.currentSet = 'collocations';
        this.cards = [];
        this.currentIndex = 0;
        this.starred = StorageManager.loadStarred();
        this.isViewingStarred = false;
        this.originalOrder = [];
        this.previousState = null;
        this.zoomLevel = 1;
        this.autoPlay = {
          enabled: false,
          timer: null,
          frontSpeed: 2000,
          backSpeed: 1000,
          mode: 'front',
          isFirstCycle: true
        };
        // æ–°å¢ï¼šä¿å­˜å¡ç‰‡åˆ†ç»„ä¿¡æ¯
        this.cardGroups = [];
      }
      reset() {
        this.currentIndex = 0;
        this.isViewingStarred = false;
        this.previousState = null;
        this.cards = [...this.originalOrder];
        this.autoPlay.isFirstCycle = true;
      }

      saveStarred() {
        StorageManager.saveStarred(this.starred);
      }
    }
    const state = new AppState();

    // === ä¿®å¤ï¼šé‡å»ºæ‰€æœ‰å¡ç‰‡å’Œåˆ†ç»„ ===
    function rebuildAllCards() {
      state.cards = buildCards(datasets[state.currentSet]);
      state.originalOrder = [...state.cards];
      
      // é‡æ–°æ„å»ºåˆ†ç»„ä¿¡æ¯
      rebuildCardGroups();
      
      // å¦‚æœå½“å‰ç´¢å¼•è¶…å‡ºèŒƒå›´ï¼Œé‡ç½®ä¸º0
      if (state.currentIndex >= state.cards.length) {
        state.currentIndex = 0;
      }
    }

    // === æ ¸å¿ƒä¿®å¤ï¼šæ”¶è—åŠŸèƒ½é€»è¾‘ ===
    function toggleStar() {
      const currentCard = state.cards[state.currentIndex];
      const originalIndex = currentCard.originalIndex;
      
      // è·å–å½“å‰çŸ­è¯­çš„æ­£åä¸¤å¼ å¡ç‰‡çš„key
      const frontKey = `${state.currentSet}-${originalIndex}-front`;
      const backKey = `${state.currentSet}-${originalIndex}-back`;
      
      // æ£€æŸ¥æ˜¯å¦å·²ç»æ”¶è—äº†æ­£é¢å¡ç‰‡
      const isCurrentlyStarred = state.starred.has(frontKey);
      
      if (state.isViewingStarred) {
        // åªæœ‰åœ¨æŸ¥çœ‹æ”¶è—çš„çŠ¶æ€ä¸‹æ‰èƒ½å–æ¶ˆæ”¶è—
        if (isCurrentlyStarred) {
          // å–æ¶ˆæ”¶è—ï¼šç§»é™¤æ­£åä¸¤é¢
          state.starred.delete(frontKey);
          state.starred.delete(backKey);
          
          // ä»å½“å‰åˆ—è¡¨ä¸­ç§»é™¤è¿™ä¸ªçŸ­è¯­çš„æ‰€æœ‰å¡ç‰‡
          state.cards = state.cards.filter(card => card.originalIndex !== originalIndex);
          rebuildCardGroups();
          
          // å¦‚æœæ”¶è—å¤¹å·²ç©ºï¼Œé€€å‡ºæ”¶è—æ¨¡å¼
          if (state.cards.length === 0) {
            state.isViewingStarred = false;
            state.cards = [...state.originalOrder];
            state.currentIndex = 0;
            rebuildCardGroups();
          } else if (state.currentIndex >= state.cards.length) {
            // å¦‚æœç§»é™¤çš„æ˜¯æœ€åä¸€å¼ ï¼Œæ˜¾ç¤ºå‰ä¸€å¼ 
            state.currentIndex = Math.max(0, state.cards.length - 1);
          }
          
          state.saveStarred();
          updateCard();
        }
      } else {
        // æ™®é€šçŠ¶æ€ä¸‹ï¼šåªèƒ½æ”¶è—ï¼Œä¸èƒ½å–æ¶ˆ
        if (!isCurrentlyStarred) {
          // æ·»åŠ æ”¶è—ï¼šæ·»åŠ æ­£åä¸¤é¢
          state.starred.add(frontKey);
          state.starred.add(backKey);
          state.saveStarred();
          updateCard();
        }
        // å¦‚æœå·²ç»æ”¶è—ï¼Œåœ¨æ™®é€šçŠ¶æ€ä¸‹ç‚¹å‡»ä¸åšä»»ä½•äº‹ï¼ˆä¸èƒ½å–æ¶ˆï¼‰
      }
    }

    // æŸ¥çœ‹æ”¶è—å¤¹
    function viewStarred() {
      if (state.starred.size === 0) {
        alert("è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•å¡ç‰‡ï¼");
        return;
      }

      state.previousState = {
        cards: [...state.cards],
        currentIndex: state.currentIndex,
        isViewingStarred: state.isViewingStarred
      };
      state.isViewingStarred = true;
      rebuildStarredCards();
      state.currentIndex = 0;
      updateCard();
    }

    // ä¿®å¤ï¼šé‡å»ºæ”¶è—å¡ç‰‡åˆ—è¡¨
    function rebuildStarredCards() {
      // æ”¶é›†æ‰€æœ‰æ”¶è—çš„çŸ­è¯­ï¼ˆæ ¹æ®åŸå§‹ç´¢å¼•ï¼‰
      const starredPhraseIndices = [];
      for (let i = 0; i < datasets[state.currentSet].length; i++) {
        const frontKey = `${state.currentSet}-${i}-front`;
        if (state.starred.has(frontKey)) {
          starredPhraseIndices.push(i);
        }
      }
      
      // ä¸ºæ¯ä¸ªæ”¶è—çš„çŸ­è¯­åˆ›å»ºæ­£åä¸¤å¼ å¡ç‰‡
      const starredCards = [];
      
      starredPhraseIndices.forEach((originalIndex, groupIndex) => {
        const phrase = datasets[state.currentSet][originalIndex];
        
        if (state.currentSet === 'typos' && phrase.length === 3) {
          // é”™åˆ«å­—ç±»å‹ï¼ˆæœ‰å›¾ç‰‡ï¼‰
          const frontCard = { 
            text: phrase[0], 
            type: 'front', 
            originalIndex: originalIndex,
            groupIndex: groupIndex,
            imageUrl: phrase[2], 
            correctChar: phrase[1]
          };
          const backCard = { 
            text: phrase[1], 
            type: 'back', 
            originalIndex: originalIndex,
            groupIndex: groupIndex,
            imageUrl: phrase[2], 
            correctChar: phrase[1]
          };
          starredCards.push(frontCard, backCard);
        } else {
          // æ™®é€šç±»å‹
          const frontCard = { 
            text: phrase[0], 
            type: 'front', 
            originalIndex: originalIndex,
            groupIndex: groupIndex
          };
          const backCard = { 
            text: phrase[1], 
            type: 'back', 
            originalIndex: originalIndex,
            groupIndex: groupIndex
          };
          starredCards.push(frontCard, backCard);
        }
      });
      
      state.cards = starredCards;
      rebuildCardGroups();
    }

    // æ„å»ºå¡ç‰‡åˆ†ç»„ä¿¡æ¯
    function rebuildCardGroups() {
      const groups = [];
      const groupedCards = {};
      
      // æŒ‰groupIndexåˆ†ç»„
      state.cards.forEach((card, index) => {
        if (!groupedCards[card.groupIndex]) {
          groupedCards[card.groupIndex] = { frontIndex: -1, backIndex: -1 };
        }
        
        if (card.type === 'front') {
          groupedCards[card.groupIndex].frontIndex = index;
        } else {
          groupedCards[card.groupIndex].backIndex = index;
        }
      });
      
      // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
      Object.keys(groupedCards).sort((a, b) => parseInt(a) - parseInt(b)).forEach(key => {
        groups.push(groupedCards[key]);
      });
      
      state.cardGroups = groups;
    }

    // ä¿®å¤ï¼šè·å–å¡ç‰‡å”¯ä¸€æ ‡è¯†
    function getCardKey(card) {
      return `${state.currentSet}-${card.originalIndex}-${card.type}`;
    }

    // ä¿®å¤ï¼šæ„å»ºå¡ç‰‡æ—¶ä¿ç•™åŸå§‹ç´¢å¼•ä¿¡æ¯
    function buildCards(phrases) {
      const cards = [];
      
      for (let i = 0; i < phrases.length; i++) {
        const phrase = phrases[i];
        // æŸ¥æ‰¾è¿™ä¸ªçŸ­è¯­åœ¨åŸå§‹æ•°æ®é›†ä¸­çš„ç´¢å¼•
        let originalIndex = -1;
        for (let j = 0; j < datasets[state.currentSet].length; j++) {
          const originalPhrase = datasets[state.currentSet][j];
          if (JSON.stringify(originalPhrase) === JSON.stringify(phrase)) {
            originalIndex = j;
            break;
          }
        }
        
        const groupIndex = Math.floor(cards.length / 2); // æ¯ç»„æœ‰ä¸¤å¼ å¡ç‰‡
        
        if (state.currentSet === 'typos' && phrase.length === 3) {
          cards.push({ 
            text: phrase[0], 
            type: 'front', 
            originalIndex: originalIndex,
            groupIndex: groupIndex,
            imageUrl: phrase[2], 
            correctChar: phrase[1]
          });
          cards.push({ 
            text: phrase[1], 
            type: 'back', 
            originalIndex: originalIndex,
            groupIndex: groupIndex,
            imageUrl: phrase[2], 
            correctChar: phrase[1]
          });
        } else {
          cards.push({ 
            text: phrase[0], 
            type: 'front', 
            originalIndex: originalIndex,
            groupIndex: groupIndex
          });
          cards.push({ 
            text: phrase[1], 
            type: 'back', 
            originalIndex: originalIndex,
            groupIndex: groupIndex
          });
        }
      }
      
      rebuildCardGroups();
      return cards;
    }

    // === ä¿®å¤å¡ç‰‡ç‚¹å‡»é€»è¾‘ï¼šå®Œå…¨åƒç¿»ä¹¦ä¸€æ · ===
    function handleCardClick(e) {
      stopAutoPlay();
      
      const card = document.getElementById('card');
      const rect = card.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const cardWidth = rect.width;
      
      // å®Œå…¨åƒç¿»ä¹¦ä¸€æ ·çš„ç®€å•é€»è¾‘
      if (clickX < cardWidth / 2) {
        // ç‚¹å‡»å·¦åŠåŒºï¼šä¸Šä¸€å¼ ï¼ˆå°±åƒå¾€å·¦ç¿»ä¹¦ï¼‰
        goToPrevCard();
      } else {
        // ç‚¹å‡»å³åŠåŒºï¼šä¸‹ä¸€å¼ ï¼ˆå°±åƒå¾€å³ç¿»ä¹¦ï¼‰
        goToNextCard();
      }
      
      updateCard();
      e.stopPropagation();
    }

    // ä¸Šä¸€å¼ ï¼ˆç®€å•å‡1ï¼‰
    function goToPrevCard() {
      if (state.cards.length === 0) return;
      
      // ç›´æ¥å‡1ï¼Œå¾ªç¯åˆ°æœ«å°¾
      state.currentIndex = (state.currentIndex - 1 + state.cards.length) % state.cards.length;
    }

    // ä¸‹ä¸€å¼ ï¼ˆç®€å•åŠ 1ï¼‰
    function goToNextCard() {
      if (state.cards.length === 0) return;
      
      // ç›´æ¥åŠ 1ï¼Œå¾ªç¯åˆ°å¼€å¤´
      state.currentIndex = (state.currentIndex + 1) % state.cards.length;
    }

    // ä¿æŒæŒ‰é’®åŠŸèƒ½ä¸€è‡´
    function prevCard() {
      stopAutoPlay();
      goToPrevCard();
      updateCard();
    }

    function nextCard() {
      stopAutoPlay();
      goToNextCard();
      updateCard();
    }

    // === ä¿®å¤ï¼šè‡ªåŠ¨æ’­æ”¾å¼•æ“ ===
    const autoPlayEngine = {
      timer: null,
      isRunning: false,
      cycleCount: 0,
      start(frontSpeed, mode) {
        this.stop();
        state.currentIndex = 0;
        updateCard();
        state.autoPlay.enabled = true;
        state.autoPlay.frontSpeed = frontSpeed;
        state.autoPlay.mode = mode;
        state.autoPlay.isFirstCycle = true;
        this.cycleCount = 0;
        this.isRunning = true;
        setTimeout(() => {
          this.executeCycle();
        }, mode === 'front' ? frontSpeed : 100);
      },
      stop() {
        this.isRunning = false;
        if (this.timer) {
          clearTimeout(this.timer);
          this.timer = null;
        }
        state.autoPlay.enabled = false;
        state.autoPlay.isFirstCycle = true;
      },
      executeCycle() {
        if (!this.isRunning) return;
        const delay = this.calculateDelay();
        this.timer = setTimeout(() => {
          if (!this.isRunning) return;
          this.performAction();
          this.cycleCount++;
          this.executeCycle();
        }, delay);
      },
      calculateDelay() {
        if (state.autoPlay.isFirstCycle) {
          state.autoPlay.isFirstCycle = false;
          return state.autoPlay.mode === 'front' ? state.autoPlay.frontSpeed : state.autoPlay.frontSpeed;
        }
        if (state.autoPlay.mode === 'front') {
          return state.autoPlay.frontSpeed;
        } else {
          const currentCard = state.cards[state.currentIndex];
          return currentCard.type === 'front' ? state.autoPlay.frontSpeed : state.autoPlay.backSpeed;
        }
      },
      performAction() {
        if (state.autoPlay.mode === 'front') {
          this.handleFrontMode();
        } else {
          this.handleBothMode();
        }
      },
      handleFrontMode() {
        this.advanceToNextCard();
        updateCard();
      },
      handleBothMode() {
        const currentCard = state.cards[state.currentIndex];
        
        // å¤„ç†å¡ç‰‡åˆ†ç»„ä¿¡æ¯ä¸å®Œæ•´çš„æƒ…å†µ
        if (!state.cardGroups || state.cardGroups.length === 0) {
          // å¦‚æœæ²¡æœ‰åˆ†ç»„ä¿¡æ¯ï¼Œç®€å•åœ°åœ¨æ­£åé¢ä¹‹é—´åˆ‡æ¢
          if (currentCard.type === 'front') {
            // å°è¯•æ‰¾åˆ°åŒä¸€åŸå§‹ç´¢å¼•çš„èƒŒé¢å¡ç‰‡
            let foundBack = false;
            for (let i = 0; i < state.cards.length; i++) {
              if (i !== state.currentIndex && 
                  state.cards[i].originalIndex === currentCard.originalIndex && 
                  state.cards[i].type === 'back') {
                state.currentIndex = i;
                foundBack = true;
                break;
              }
            }
            
            // å¦‚æœæ²¡æ‰¾åˆ°èƒŒé¢å¡ç‰‡ï¼Œç›´æ¥è·³åˆ°ä¸‹ä¸€å¼ æ­£é¢å¡ç‰‡
            if (!foundBack) {
              this.advanceToNextCard();
            }
          } else {
            // å½“å‰æ˜¯èƒŒé¢ï¼Œè·³åˆ°ä¸‹ä¸€å¼ æ­£é¢å¡ç‰‡
            this.advanceToNextCard();
          }
        } else {
          // ä½¿ç”¨åŸæ¥çš„åˆ†ç»„é€»è¾‘
          if (currentCard.type === 'front') {
            // å¦‚æœæ˜¯æ­£é¢ï¼Œæ˜¾ç¤ºåŒä¸€ç»„çš„èƒŒé¢
            const currentGroupIndex = currentCard.groupIndex;
            if (state.cardGroups[currentGroupIndex] && state.cardGroups[currentGroupIndex].backIndex !== -1) {
              state.currentIndex = state.cardGroups[currentGroupIndex].backIndex;
            }
          } else {
            // å¦‚æœæ˜¯èƒŒé¢ï¼Œæ‰¾åˆ°ä¸‹ä¸€ç»„çš„æ­£é¢
            const currentGroupIndex = currentCard.groupIndex;
            const nextGroupIndex = (currentGroupIndex + 1) % state.cardGroups.length;
            
            // æ‰¾åˆ°ä¸‹ä¸€ç»„çš„æ­£é¢å¡ç‰‡
            let foundNextFront = false;
            for (let i = 0; i < state.cards.length; i++) {
              const card = state.cards[i];
              if (card.groupIndex === nextGroupIndex && card.type === 'front') {
                state.currentIndex = i;
                foundNextFront = true;
                break;
              }
            }
            
            // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå›åˆ°ç¬¬ä¸€ç»„çš„æ­£é¢
            if (!foundNextFront) {
              for (let i = 0; i < state.cards.length; i++) {
                if (state.cards[i].type === 'front') {
                  state.currentIndex = i;
                  break;
                }
              }
            }
          }
        }
        updateCard();
      },
      advanceToNextCard() {
        if (state.isViewingStarred) {
          // æ”¶è—æ¨¡å¼ä¸‹ï¼šæ˜¾ç¤ºä¸‹ä¸€ç»„çš„æ­£é¢
          const currentCard = state.cards[state.currentIndex];
          const currentGroupIndex = currentCard.groupIndex;
          const nextGroupIndex = (currentGroupIndex + 1) % state.cardGroups.length;
          if (state.cardGroups[nextGroupIndex]) {
            state.currentIndex = state.cardGroups[nextGroupIndex].frontIndex;
          } else {
            state.currentIndex = 0;
          }
        } else {
          // æ™®é€šæ¨¡å¼
          let nextIndex = (state.currentIndex + 1) % state.cards.length;
          while (state.cards[nextIndex].type !== 'front' && nextIndex !== state.currentIndex) {
            nextIndex = (nextIndex + 1) % state.cards.length;
          }
          state.currentIndex = nextIndex;
        }
      }
    };

    // === å…¶ä»–å‡½æ•°ï¼ˆä¿æŒä¸å˜ï¼‰===
    function setZoom(level) {
      state.zoomLevel = Math.max(0.5, Math.min(2, level));
      document.getElementById('appContainer').style.transform = `scale(${state.zoomLevel})`;
      document.getElementById('zoomIndicator').textContent = `${Math.round(state.zoomLevel * 100)}%`;
      
      setTimeout(() => {
        updateSliderPosition();
      }, 50);
    }

    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    function updateCard() {
      if (state.cards.length === 0) {
        document.getElementById('card-text').textContent = 'æ²¡æœ‰å¯ç”¨å¡ç‰‡';
        document.getElementById('progress').textContent = '0 / 0';
        document.querySelector('.progress-fill').style.width = '0%';
        return;
      }
      const card = state.cards[state.currentIndex];
      const cardElement = document.getElementById('card');
      const elementsToRemove = [
        '.card-image', '.card-hint', '.divider', '.correct-character', '.sentence-container',
        '.translation-container', '.example-container', '.typo-back-container', '.vertical-divider',
        '.sentence-hint', '.typo-label', '.typo-label-right', '.card-star', '.example-label', '.typo-connector'
      ];
      elementsToRemove.forEach(selector => {
        const el = cardElement.querySelector(selector);
        if (el) el.remove();
      });
      
      // ç§»é™¤ä¹‹å‰æ·»åŠ çš„å·¦ä¸Šè§’å’Œå³ä¸Šè§’æ–‡å­—ï¼ˆå·²åˆ é™¤ç›¸å…³ä»£ç ï¼‰
      
      if (state.currentSet === 'typos' && card.imageUrl) {
        if (card.type === 'back') {
          const typoBackContainer = document.createElement('div');
          typoBackContainer.className = 'typo-back-container';
          const typoImageContainer = document.createElement('div');
          typoImageContainer.className = 'typo-image-container';
          const img = document.createElement('img');
          img.className = 'card-image'; img.src = card.imageUrl; img.alt = 'é”™åˆ«å­—å›¾ç‰‡';
          typoImageContainer.appendChild(img);
          const typoLabelLeft = document.createElement('div'); typoLabelLeft.className = 'typo-label'; typoLabelLeft.textContent = 'é”™å­—';
          typoImageContainer.appendChild(typoLabelLeft);
          const verticalDivider = document.createElement('div'); verticalDivider.className = 'vertical-divider';
          const typoCharacterContainer = document.createElement('div'); typoCharacterContainer.className = 'typo-character-container';
          const correctCharElement = document.createElement('div'); correctCharElement.className = 'correct-character'; correctCharElement.textContent = card.correctChar;
          correctCharElement.style.fontFamily = "'Noto Serif SC', serif"; correctCharElement.style.fontWeight = '700';
          typoCharacterContainer.appendChild(correctCharElement);
          const typoLabelRight = document.createElement('div'); typoLabelRight.className = 'typo-label-right'; typoLabelRight.textContent = 'æ”¹æ­£';
          typoCharacterContainer.appendChild(typoLabelRight);
          typoBackContainer.appendChild(typoImageContainer);
          typoBackContainer.appendChild(verticalDivider);
          typoBackContainer.appendChild(typoCharacterContainer);
          const connector = document.createElement('div'); connector.className = 'typo-connector';
          typoBackContainer.appendChild(connector);
          cardElement.appendChild(typoBackContainer);
          document.getElementById('card-text').textContent = '';
        } else {
          const typoContainer = document.createElement('div');
          typoContainer.className = 'sentence-container';
          const img = document.createElement('img');
          img.className = 'card-image'; img.src = card.imageUrl; img.alt = 'é”™åˆ«å­—å›¾ç‰‡';
          typoContainer.appendChild(img);
          const divider = document.createElement('div'); divider.className = 'divider';
          typoContainer.appendChild(divider);
          const hint = document.createElement('div'); hint.className = 'sentence-hint';
          hint.textContent = 'ğŸ’¡ æƒ³ä¸€æƒ³ï¼Œå“ªé‡Œé”™äº†ï¼Ÿ'; hint.style.color = 'var(--dark-blue)';
          hint.style.fontFamily = "'Noto Serif SC', serif"; hint.style.fontWeight = '300';
          typoContainer.appendChild(hint);
          cardElement.appendChild(typoContainer);
          document.getElementById('card-text').textContent = '';
        }
      } else if (state.currentSet === 'typos' && !card.imageUrl) {
        if (card.type === 'back') {
          const parts = card.text.split('\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');
          if (parts.length >= 2) {
            const container = document.createElement('div');
            container.className = 'sentence-container';
            const originalPart = document.createElement('div'); originalPart.className = 'sentence-part';
            const original = document.createElement('div'); original.className = 'original-sentence';
            const orig = parts[0].replace('åŸå¥ï¼š', '');
            const corr = parts[1].replace('æ”¹æ­£ï¼š', '');
            let typoChar = '', correctChar = '';
            for (let i = 0; i < Math.min(orig.length, corr.length); i++) {
              if (orig[i] !== corr[i]) { typoChar = orig[i]; correctChar = corr[i]; break; }
            }
            original.innerHTML = `åŸå¥ï¼š<span>${typoChar ? orig.replace(typoChar, `<span style="color:var(--error-color)">${typoChar}</span>`) : orig}</span>`;
            original.style.color = 'var(--dark-blue)';
            originalPart.appendChild(original);
            container.appendChild(originalPart);
            const divider = document.createElement('div'); divider.className = 'divider';
            container.appendChild(divider);
            const correctedPart = document.createElement('div'); correctedPart.className = 'sentence-part';
            const corrected = document.createElement('div'); corrected.className = 'corrected-sentence';
            corrected.innerHTML = `æ”¹æ­£ï¼š<span>${correctChar ? corr.replace(correctChar, `<span style="color:var(--error-color)">${correctChar}</span>`) : corr}</span>`;
            corrected.style.color = 'var(--dark-blue)';
            correctedPart.appendChild(corrected);
            container.appendChild(correctedPart);
            cardElement.appendChild(container);
            document.getElementById('card-text').textContent = '';
          }
        } else {
          const container = document.createElement('div'); container.className = 'sentence-container';
          const text = document.createElement('div'); text.className = 'original-sentence';
          text.textContent = card.text; text.style.color = 'var(--dark-blue)';
          text.style.fontFamily = "'Noto Serif SC', serif"; text.style.fontSize = '22px';
          container.appendChild(text);
          const divider = document.createElement('div'); divider.className = 'divider';
          container.appendChild(divider);
          const hint = document.createElement('div'); hint.className = 'sentence-hint';
          hint.textContent = 'ğŸ’¡ æƒ³ä¸€æƒ³ï¼Œå“ªé‡Œé”™äº†ï¼Ÿ'; hint.style.color = 'var(--dark-blue)';
          hint.style.fontFamily = "'Noto Serif SC', serif"; hint.style.fontWeight = '300';
          container.appendChild(hint);
          cardElement.appendChild(container);
          document.getElementById('card-text').textContent = '';
        }
      } else if (state.currentSet === 'sentences') {
        if (card.type === 'back') {
          const parts = card.text.split('\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');
          if (parts.length >= 2) {
            const container = document.createElement('div'); container.className = 'sentence-container';
            const originalPart = document.createElement('div'); originalPart.className = 'sentence-part';
            const original = document.createElement('div'); original.className = 'original-sentence';
            const orig = parts[0].replace('åŸå¥ï¼š', '');
            if (orig === "æˆ‘ä»¬æ­£åœ¨è®¨è®ºå¦‚æœåº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚") {
              original.innerHTML = 'åŸå¥ï¼š<div style="margin-bottom:5px">æˆ‘ä»¬æ­£åœ¨è®¨è®º</div><div style="padding-left:3em">å¦‚æœåº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚</div>';
            } else {
              original.innerHTML = `åŸå¥ï¼š${orig}`;
            }
            original.style.color = 'var(--dark-blue)';
            originalPart.appendChild(original);
            container.appendChild(originalPart);
            const divider = document.createElement('div'); divider.className = 'divider';
            container.appendChild(divider);
            const correctedPart = document.createElement('div'); correctedPart.className = 'sentence-part';
            const corrected = document.createElement('div'); corrected.className = 'corrected-sentence';
            const corr = parts[1].replace('æ”¹æ­£ï¼š', '');
            if (corr === "æˆ‘ä»¬æ­£åœ¨è®¨è®ºæ˜¯å¦åº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚") {
              corrected.innerHTML = 'æ”¹æ­£ï¼š<div style="margin-bottom:5px">æˆ‘ä»¬æ­£åœ¨è®¨è®º</div><div style="padding-left:3em">æ˜¯å¦åº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚</div>';
            } else {
              corrected.innerHTML = `æ”¹æ­£ï¼š${corr}`;
            }
            corrected.style.color = 'var(--dark-blue)';
            correctedPart.appendChild(corrected);
            container.appendChild(correctedPart);
            cardElement.appendChild(container);
            document.getElementById('card-text').textContent = '';
          }
        } else {
          const container = document.createElement('div'); container.className = 'sentence-container';
          const text = document.createElement('div'); text.className = 'original-sentence';
          if (card.text === "æˆ‘ä»¬æ­£åœ¨è®¨è®ºå¦‚æœåº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚") {
            text.innerHTML = '<div style="margin-bottom:5px">æˆ‘ä»¬æ­£åœ¨è®¨è®º</div><div style="padding-left:3em">å¦‚æœåº”è¯¥å‚åŠ è¿™ä¸ªæ¯”èµ›ã€‚</div>';
          } else {
            text.textContent = card.text;
          }
          text.style.color = 'var(--dark-blue)';
          text.style.fontFamily = "'Noto Serif SC', serif"; text.style.fontSize = '22px';
          container.appendChild(text);
          const divider = document.createElement('div'); divider.className = 'divider';
          container.appendChild(divider);
          const hint = document.createElement('div'); hint.className = 'sentence-hint';
          hint.textContent = 'ğŸ’¡ æƒ³ä¸€æƒ³ï¼Œå“ªé‡Œé”™äº†ï¼Ÿ'; hint.style.color = 'var(--dark-blue)';
          hint.style.fontFamily = "'Noto Serif SC', serif"; hint.style.fontWeight = '300';
          container.appendChild(hint);
          cardElement.appendChild(container);
          document.getElementById('card-text').textContent = '';
        }
      } else if (state.currentSet === 'collocations') {
        if (card.type === 'back') {
          const parts = card.text.split('\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n');
          if (parts.length >= 2) {
            const translationParts = parts[0].split(' | ');
            if (translationParts.length >= 2) {
              const container = document.createElement('div');
              container.className = 'translation-container';
              const main = document.createElement('div'); main.className = 'translation-main';
              const chinese = document.createElement('div'); chinese.className = 'chinese-text';
              chinese.textContent = translationParts[0]; chinese.style.fontFamily = "'Noto Serif SC', serif";
              main.appendChild(chinese);
              const english = document.createElement('div'); english.className = 'english-text-back';
              english.textContent = translationParts[1]; english.style.color = 'var(--dark-blue)';
              english.style.fontWeight = '300'; english.style.fontFamily = 'Arial, sans-serif';
              main.appendChild(english);
              container.appendChild(main);
              const divider = document.createElement('div'); divider.className = 'divider';
              container.appendChild(divider);
              const example = document.createElement('div'); example.className = 'example-container';
              const exampleText = document.createElement('div'); exampleText.className = 'example-text';
              exampleText.style.fontFamily = "'Noto Serif SC', serif";
              exampleText.style.fontWeight = '300';
              exampleText.style.color = 'var(--dark-blue)';
              parts[1].split('\n').forEach(line => {
                if (line.trim()) {
                  const lineEl = document.createElement('span'); lineEl.className = 'example-line'; lineEl.textContent = line;
                  exampleText.appendChild(lineEl);
                }
              });
              example.appendChild(exampleText);
              container.appendChild(example);
              cardElement.appendChild(container);
              document.getElementById('card-text').textContent = '';
            }
          }
        } else {
          const container = document.createElement('div'); container.className = 'translation-container';
          const text = document.createElement('div'); text.className = 'english-text';
          text.textContent = card.text; text.style.color = 'var(--dark-blue)';
          text.style.fontSize = '28px'; text.style.fontWeight = '300'; text.style.fontFamily = 'Arial, sans-serif';
          container.appendChild(text);
          const divider = document.createElement('div'); divider.className = 'divider';
          container.appendChild(divider);
          const hint = document.createElement('div'); hint.className = 'sentence-hint';
          hint.textContent = 'ğŸ’¡ æƒ³ä¸€æƒ³ï¼Œåæ–‡æ€æ ·è¯´ï¼Ÿ'; hint.style.color = 'var(--dark-blue)';
          hint.style.fontSize = '22px'; hint.style.fontFamily = "'Noto Serif SC', serif"; hint.style.fontWeight = '300';
          container.appendChild(hint);
          cardElement.appendChild(container);
          document.getElementById('card-text').textContent = '';
        }
      } else {
        document.getElementById('card-text').textContent = card.text;
        document.getElementById('card-text').style.color = 'var(--dark-blue)';
        document.getElementById('card-text').style.fontSize = '28px';
        document.getElementById('card-text').style.fontFamily = "'Noto Serif SC', serif";
        document.getElementById('card-text').style.fontWeight = '300';
      }
      
      // æ˜¾ç¤ºæ”¶è—çŠ¶æ€ - æ£€æŸ¥å½“å‰çŸ­è¯­æ˜¯å¦è¢«æ”¶è—ï¼ˆæ£€æŸ¥æ­£é¢å¡ç‰‡ï¼‰
      const frontKey = `${state.currentSet}-${card.originalIndex}-front`;
      if (state.starred.has(frontKey)) {
        const star = document.createElement('div'); 
        star.className = 'card-star'; 
        star.textContent = 'â˜…';
        cardElement.appendChild(star);
      }

      const total = state.cards.length;
      const current = state.currentIndex + 1;
      if (total === 0) {
        document.getElementById('progress').textContent = '0 / 0';
        document.querySelector('.progress-fill').style.width = '0%';
      } else {
        document.getElementById('progress').textContent = `${current} / ${total}`;
        const isLast = (state.currentIndex === total - 1);
        document.querySelector('.progress-fill').style.width = isLast ? '100%' : `${(current / total) * 100}%`;
      }
      setTimeout(() => {
        updateSliderPosition();
      }, 10);
    }

    function resetCards() {
      state.isViewingStarred = false;
      state.previousState = null;
      rebuildAllCards();
      state.currentIndex = 0;
      updateCard();
    }
    
    function shuffleCards() {
      state.isViewingStarred = false;
      state.previousState = null;
      const shuffledPhrases = shuffleArray([...datasets[state.currentSet]]);
      state.cards = buildCards(shuffledPhrases);
      state.currentIndex = 0;
      updateCard();
    }
    
    function switchDataset(setName) {
      stopAutoPlay(); // å…ˆåœæ­¢è‡ªåŠ¨æ’­æ”¾
      
      state.currentSet = setName;
      state.isViewingStarred = false;
      state.previousState = null;
      
      rebuildAllCards(); // ä½¿ç”¨æ–°çš„å‡½æ•°é‡å»ºå¡ç‰‡
      
      state.currentIndex = 0;
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.set === setName);
      });
      
      updateCard();
    }
    
    function showCreatorInfo() {
      document.getElementById('creatorInfo').classList.add('active');
    }
    
    function hideCreatorInfo() {
      document.getElementById('creatorInfo').classList.remove('active');
    }
    
    function startAutoPlay(frontSpeed, mode) {
      // ç¡®ä¿å…ˆåœæ­¢ä»»ä½•æ­£åœ¨è¿è¡Œçš„è‡ªåŠ¨æ’­æ”¾
      stopAutoPlay();
      
      // è®¾ç½®æ–°æ¨¡å¼
      state.autoPlay.mode = mode;
      
      // å¼€å§‹æ–°çš„è‡ªåŠ¨æ’­æ”¾
      autoPlayEngine.start(frontSpeed, mode);
      updateButtonStates();
      hideAllDropdowns();
    }
    
    function stopAutoPlay() {
      autoPlayEngine.stop();
      updateButtonStates();
    }
    
    function showDropdown(dropdownId, buttonId) {
      const dropdown = document.getElementById(dropdownId);
      const button = document.getElementById(buttonId);
      const rect = button.getBoundingClientRect();
      hideAllDropdowns();
      dropdown.style.display = 'block';
      const buttonCenterX = rect.left + rect.width / 2;
      const dropdownWidth = dropdown.offsetWidth;
      const leftPosition = buttonCenterX - dropdownWidth / 2;
      const topPosition = rect.top - dropdown.offsetHeight - 10;
      const safeLeft = Math.max(10, Math.min(window.innerWidth - dropdownWidth - 10, leftPosition));
      const safeTop = Math.max(10, topPosition);
      dropdown.style.left = safeLeft + 'px';
      dropdown.style.top = safeTop + 'px';
    }
    
    function hideAllDropdowns() {
      document.getElementById('speedDropdown').style.display = 'none';
      document.getElementById('translationDropdown').style.display = 'none';
    }
    
    function updateButtonStates() {
      const frontBtn = document.getElementById('autoPlayFrontBtn');
      const bothBtn = document.getElementById('autoPlayBothBtn');
      if (state.autoPlay.enabled) {
        if (state.autoPlay.mode === 'front') {
          frontBtn.innerHTML = '<span class="btn-icon pause-icon">âšâš</span>';
          bothBtn.innerHTML = '<span class="btn-icon auto-play-icon">â–·â–·</span>';
          frontBtn.classList.add('active');
          bothBtn.classList.remove('active');
        } else {
          frontBtn.innerHTML = '<span class="btn-icon auto-play-icon">â–·</span>';
          bothBtn.innerHTML = '<span class="btn-icon pause-icon">âšâš</span>';
          frontBtn.classList.remove('active');
          bothBtn.classList.add('active');
        }
      } else {
        frontBtn.innerHTML = '<span class="btn-icon auto-play-icon">â–·</span>';
        bothBtn.innerHTML = '<span class="btn-icon auto-play-icon">â–·â–·</span>';
        frontBtn.classList.remove('active');
        bothBtn.classList.remove('active');
      }
    }
    
    function zoomIn() {
      setZoom(state.zoomLevel + 0.1);
    }
    
    function zoomOut() {
      setZoom(state.zoomLevel - 0.1);
    }
    
    function updateSliderPosition() {
      const slider = document.getElementById('progressSlider');
      const progressBar = document.getElementById('progressBar');
      if (!slider || !progressBar || state.cards.length === 0) return;

      const barWidth = progressBar.offsetWidth;
      const sliderWidth = slider.offsetWidth;
      const trackWidth = barWidth - sliderWidth;
      const percent = state.cards.length > 1 ? state.currentIndex / (state.cards.length - 1) : 0;
      const left = (sliderWidth / 2) + (percent * trackWidth);

      slider.style.left = `${left}px`;
    }

    function jumpToPosition(percentage) {
      if (state.cards.length === 0) return;
      if (percentage >= 0.99) {
        state.currentIndex = state.cards.length - 1;
      } else {
        state.currentIndex = Math.min(
          Math.floor(percentage * state.cards.length),
          state.cards.length - 1
        );
      }
      updateCard();
    }
    
    function setupSliderDrag() {
      const container = document.getElementById('progressSliderContainer');
      const slider = document.getElementById('progressSlider');
      const bar = document.getElementById('progressBar');
      if (!container || !slider || !bar) return;
      let isDragging = false;
      function start(e) {
        isDragging = true;
        e.preventDefault();
        stopAutoPlay();
        slider.style.transition = 'none';
      }
      function move(e) {
        if (!isDragging) return;
        e.preventDefault();
        const rect = bar.getBoundingClientRect();
        
        const x = ((e.touches?.[0] || e).clientX - rect.left) / state.zoomLevel;
        const pct = Math.max(0, Math.min(1, x / bar.offsetWidth));
        
        slider.style.left = `${x}px`;
        
        if (pct >= 0.95) {
          jumpToPosition(1);
        } else {
          jumpToPosition(pct);
        }
      }

      function end(e) {
        if (!isDragging) return;
        isDragging = false;
        slider.style.transition = 'left 0.3s ease';
      }
      container.addEventListener('mousedown', start);
      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
      container.addEventListener('touchstart', start);
      document.addEventListener('touchmove', move);
      document.addEventListener('touchend', end);
      bar.addEventListener('click', function(e) {
        const rect = bar.getBoundingClientRect();
        
        const x = (e.clientX - rect.left) / state.zoomLevel;
        const pct = Math.max(0, Math.min(1, x / bar.offsetWidth));
        
        jumpToPosition(pct >= 0.95 ? 1 : pct);
      });
    }
    
    function initApp() {
      console.log("åˆå§‹åŒ–åº”ç”¨ï¼Œå·²åŠ è½½æ”¶è—æ•°é‡:", state.starred.size);
      rebuildAllCards();
      
      document.getElementById('nextBtn').addEventListener('click', () => { stopAutoPlay(); nextCard(); });
      document.getElementById('prevBtn').addEventListener('click', () => { stopAutoPlay(); prevCard(); });
      document.getElementById('starBtn').addEventListener('click', () => { stopAutoPlay(); toggleStar(); });
      document.getElementById('resetBtn').addEventListener('click', () => { stopAutoPlay(); resetCards(); });
      document.getElementById('shuffleBtn').addEventListener('click', () => { stopAutoPlay(); shuffleCards(); });
      document.getElementById('bookmarksBtn').addEventListener('click', () => { stopAutoPlay(); viewStarred(); });
      
      // ç§»é™¤ç‹¬ç«‹çš„å·¦å³ç‚¹å‡»ç›‘å¬å™¨ï¼Œæ‰€æœ‰ç‚¹å‡»é€šè¿‡handleCardClickå¤„ç†
      document.getElementById('card').addEventListener('click', handleCardClick);
      
      document.getElementById('autoPlayFrontBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        if (state.autoPlay.enabled && state.autoPlay.mode === 'front') {
          stopAutoPlay();
        } else {
          // å¦‚æœå½“å‰æ˜¯å…¶ä»–è‡ªåŠ¨æ’­æ”¾æ¨¡å¼ï¼Œå…ˆåœæ­¢å†åˆ‡æ¢åˆ°æ­£é¢æ¨¡å¼
          if (state.autoPlay.enabled) {
            stopAutoPlay();
          }
          showDropdown('speedDropdown', 'autoPlayFrontBtn');
        }
      });
      
      document.getElementById('autoPlayBothBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        if (state.autoPlay.enabled && state.autoPlay.mode === 'both') {
          stopAutoPlay();
        } else {
          // å¦‚æœå½“å‰æ˜¯å…¶ä»–è‡ªåŠ¨æ’­æ”¾æ¨¡å¼ï¼Œå…ˆåœæ­¢å†åˆ‡æ¢åˆ°æ­£åé¢æ¨¡å¼
          if (state.autoPlay.enabled) {
            stopAutoPlay();
          }
          showDropdown('translationDropdown', 'autoPlayBothBtn');
        }
      });
      
      document.querySelectorAll('#speedDropdown .dropdown-option').forEach(option => {
        option.addEventListener('click', function(e) {
          e.stopPropagation();
          const speed = parseInt(this.dataset.speed);
          startAutoPlay(speed, 'front');
        });
      });
      
      document.querySelectorAll('#translationDropdown .dropdown-option').forEach(option => {
        option.addEventListener('click', function(e) {
          e.stopPropagation();
          const frontSpeed = parseInt(this.dataset.frontSpeed);
          startAutoPlay(frontSpeed, 'both');
        });
      });
      
      document.getElementById('closeCreator').addEventListener('click', hideCreatorInfo);
      document.getElementById('copyrightBtn').addEventListener('click', showCreatorInfo);
      
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          switchDataset(this.dataset.set);
        });
      });
      
      document.getElementById('zoomInBtn').addEventListener('click', zoomIn);
      document.getElementById('zoomOutBtn').addEventListener('click', zoomOut);
      document.addEventListener('click', hideAllDropdowns);
      
      let initialDistance = 0;
      let initialZoom = 1;
      const handleTouchStart = (e) => {
        if (e.touches.length === 2) {
          initialDistance = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
          initialZoom = state.zoomLevel;
        }
      };
      
      const handleTouchMove = (e) => {
        if (e.touches.length === 2) {
          const currentDistance = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
          if (initialDistance > 0) {
            const scale = currentDistance / initialDistance;
            const newZoom = initialZoom * scale;
            setZoom(Math.max(0.5, Math.min(2, newZoom)));
          }
        }
      };
      
      const handleTouchEnd = () => {
        initialDistance = 0;
      };
      
      const appContainer = document.getElementById('appContainer');
      appContainer.addEventListener('touchstart', handleTouchStart);
      appContainer.addEventListener('touchmove', handleTouchMove);
      appContainer.addEventListener('touchend', handleTouchEnd);
      
      setupSliderDrag();
      updateCard();
      updateButtonStates();
      setTimeout(autoFitToScreen, 100);
    }
    
    function autoFitToScreen() {
      const appContainer = document.getElementById('appContainer');
      if (!appContainer) return;

      const viewportHeight = window.innerHeight;
      const appHeight = appContainer.offsetHeight;

      if (appHeight > viewportHeight) {
        const scale = (viewportHeight / appHeight) * 0.98;
        appContainer.style.transformOrigin = 'center top';
        appContainer.style.transform = `scale(${scale})`;

        const zoomIndicator = document.getElementById('zoomIndicator');
        if (zoomIndicator) {
          zoomIndicator.textContent = `${Math.round(scale * 100)}%`;
        }
        
        if (window.state) {
          window.state.zoomLevel = scale;
        }
      }
    }

    window.addEventListener('load', initApp);
  </script>
</body>
</html>